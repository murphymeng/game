<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
        }
        .mf {
            background-color: red;
        }
    </style>
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">

    function Card(obj) {
        var me = this;
        me.name = obj.name;
        me.cd = obj.cd;

        me.go = function() {
            if(me.img) {
                $(me.img).animate({top: '30px'});
            }
        }
    }

    var round = {
        currentRound: 1
    };

    var paiku = {
        row: 2,
        column: 5,
        cw: 80, // 单元格长度
        boardArray: [],
        myCardConfig: [{
            name: 'daqiao',
            cd: 1
        }, {
            name: 'zhaoyun',
            cd: 1
        }],
        cards: [],
        ctx: null,

        shangzhen: function() {
            var me = this;
            $.each(me.cards, function(idx, card) {
                if (card.cd === round.currentRound) {
                    card.go();
                }
            });
        },

        addCard: function(card, x, y) {
            var me = this;
            card.x = x;
            card.y = y;
            me.cards.push(card);

            var img = new Image();

            img.onload = function () {
                $('#paiku').append(img);
            };
            img.width = 80;
            img.height = 80;
            img.src = 'res/' + card.name + '.png';
            card.img = img;
        },

        getCardByPos: function(x, y) {
            var me = this;
            for (var i = 0; i < me.cards.length; i++) {
                if (me.cards[i].x === x && me.cards[i].y === y) {
                    return cards[i];
                }
            }
            return null;
        },

        init: function() {
            var me = this,
                card,
                paiku_div,
                img;

            me.paiku = $('#paiku');

            for(var i = 0; i < me.row; i++) {
                for (var j = 0; j < me.column; j++) {
                    me.paiku.append("<div class='paiku_div' id='" + i + j + "''></div>");
                    paiku_div = $('#' + i + j);
                    paiku_div.css({
                        "background-color":"yellow",
                        "height": me.cw,
                        "width" : me.cw,
                        "float" : 'left'
                    });
                    if (me.myCardConfig.length > 0) {
                        carConfig = me.myCardConfig.pop();

                        img = new Image();
                        img.pid = '' + i + j;
                        img.id = 'img' + i + j;
                        img.width = me.cw;
                        img.height = me.cw;
                        img.src = 'res/' + carConfig.name + '.png';
                        img.onload = function (e) {
                            $('#' + e.target.pid).append(e.target);
                        };

                        card = new Card(carConfig);
                        card.img = img;
                        me.cards.push(card);
                    }
                }
            }

            for(var k = 0; k < me.myCardConfig.length; k++) {
                var card = new Card(me.myCardConfig[k].name);
                me.addCard(card, k  , 0);
            }
            
        }
    };

    var board = {
        row: 6,
        column: 5,
        cw: 80, // 单元格长度
        boardArray: [],

        init: function() {
            var me = this,
                canvas = $('#canvas')[0],
                ctx = canvas.getContext('2d');

            for(var i = 0; i <= me.row; i++) {
                ctx.moveTo(0, i * me.cw);
                ctx.lineTo(me.column * me.cw, i * me.cw);
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            for(i = 0; i <= me.column; i++) {
                ctx.moveTo(i * me.cw, 0);
                ctx.lineTo(i * me.cw, me.row * me.cw);
                ctx.stroke();
            }

            for(i = 0; i < me.row; i++) {
                me.boardArray[i] = [];
                for (var j = 0; j < me.column; j++) {
                    me.boardArray[i].push(0);
                }
            }
        }
    };

    $(document).ready(function() {
        var canvas = $('#canvas')[0],
            ctx = canvas.getContext('2d');

        board.init();
        paiku.init();   

        var daqiao = new Card('daqiao'),
            img = new Image();

        img.onload = function () {
            ctx.drawImage(img, 0, 0, 80, 80);
        };
        img.src = 'res/daqiao.png';

        canvas.onclick = function(e) {
            var a = 1;
            //bx = 
        }
    })


    </script>
</head>
<body>
    <canvas id="canvas" width="400" height="480"></canvas>
    <div style="clear:both"></div>
    <div id="paiku" style="width:400px; height: 160px"></div>
    <div id="controlArea"><button type="button" style="float: left" onclick=""/>上阵</div>
</body>
</html>